extends layout

block stylesheet
  link(rel='stylesheet', href='//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css')
  link(rel='stylesheet', href='//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css')
  link(rel='stylesheet', href='/stylesheets/main_page.css')

block scripts
  script(src='https://code.jquery.com/jquery-2.1.1.min.js')
  script(src='https://code.jquery.com/ui/1.11.2/jquery-ui.min.js')
  script(src='//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js')
  script(src='//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js')
  script(src='javascripts/commit_info.js')
  script(src='javascripts/tag.js')
  script(src='javascripts/commit.js')
  script(type='text/javascript').
    $(function() {
      $tagEditDialog = $('#tag_edit_dialog');
      var commitInfoSelecters = {
        $commitInfoTable: $('#find_info .commit_info_table'),
        $findDialog: $('#find_dialog'),
        $historyDialog: $('#history_dialog'),
        $tagEditDialog: $tagEditDialog
      };
      var find = gspecv.setupCommitInfo(commitInfoSelecters);

      gspecv.tag.setup({
        tagCreateDialog: '#tag_create_dialog',
        $tagCreateButton: $('#tag_create_dialog #create_button'),
        tagCreateNameInput: '#tag_create_dialog #tag_name',
        $tagEditDialog: $tagEditDialog,
        $applyTagButton: $tagEditDialog.find('#apply_button'),
        $fileTagList: $('#tag_edit_dialog .left_tag_list'),
        $stockTagList: $('#tag_edit_dialog .right_tag_list')
      },
      find);

      gspecv.setupCommit($('#commit_box'), function() {
        // コミットを行ったら、ファイル一覧の表示を更新する
        find();
      });
    });

block content
  nav.navbar.navbar-default.navbar-fixed-top(role='navigation')
    div.container
      div.navbar-header
        div.navbar-brand #{title}
      div.navbar-collapse.collapse#navbar
        ul.nav.navbar-nav.navbar-right
          li.dropdown
            a.dropdown-toggle(href='#' data-toggle='dropdown' role='button' aria-expanded='false') #{user_name}
              span.caret
            ul.dropdown-menu(role='menu')
              li
                a(href='/login/logout') Logout

  div.container#find_info
    button.btn.btn-primary(data-toggle='modal' data-target='#find_dialog')
      span.glyphicon.glyphicon-search(aria-hidden="true")
        検索
    table.table.table-striped.commit_info_table

  div#commit_box
    div#file_names
    textarea.form-control#comment_text
    div.row
      button.btn.pull-right.btn-primary#commit_button(disabled) commit
      button.btn.pull-right#cancel_button(disabled) cancel

  include ./find_dialog.jade
  include ./tag_edit_dialog.jade
  include ./history_dialog.jade
